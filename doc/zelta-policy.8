.\" Automatically generated by Pandoc 3.2
.\"
.TH "zelta\-policy" "8" "" "" "System Manager\[cq]s Manual"
.SH NAME
\f[B]zelta policy\f[R] \- Execute a list of \f[B]zelta backup\f[R]
operations from a configuration file.
.SH SYNOPSIS
\f[B]zelta policy\f[R] [\f[I]backup\-override\-options\f[R]]
[\f[I]site\f[R]|\f[I]host\f[R]|\f[I]dataset\f[R]] \f[I]\&...\f[R]
.SH DESCRIPTION
\f[B]zelta policy\f[R] reads from a simple YAML\-style configuration
file containing parameters for \f[B]zelta backup\f[R].
Running \f[B]zelta policy\f[R] without parameters will iterate through
the entire configuration file.
Override options for either \f[B]zelta policy\f[R] or \f[B]zelta
backup\f[R] can be provided on the command line, for example, adding
\f[CR]\-\-json\f[R] will cause that parameter to be passed to all
\f[B]zelta backup\f[R] calls.
Subsequent undashed parameters will be matched against a user\-defined
\f[I]site\f[R] name, \f[I]host\f[R] name, or \f[I]dataset\f[R], and the
backup processes will be limited to that group or item.
.SS Options
In the \f[B]zelta policy\f[R] configuration file, you may override
\f[B]zelta backup\f[R]\[cq]s default parameters as defined in
\f[B]zelta\-backup(8)\f[R].
The following parameters are specific \f[B]zelta policy\f[R]:
.TP
\f[B]\[en]backup\-root=\f[BI]dataset\f[B]\f[R]
The default \f[I]target\f[R] dataset for replication jobs.
For example, if given \f[B]backup_root\f[R] of \f[CR]pool/Backups\f[R]
and a \f[I]source\f[R] dataset endpoint
of\f[CR]host01:tank01/vm/myOS\f[R], the \f[I]target\f[R] dataset will be
\f[CR]pool/Backups/myOS\f[R].
.TP
\f[B]\[en]prefix=\f[BI]num\-elements\f[B]\f[R]
Construct a target name using \f[B]backup_root\f[R] plus the indicated
number of \f[I]source\f[R] elements.
If given a \f[B]prefix\f[R] of \f[CR]1\f[R] in the previous example, the
\f[I]target\f[R] will be \f[CR]pool/Backups/vm/myOS\f[R].
.TP
\f[B]\[en]host_prefix\f[R]
Construct a target name using \f[B]backup_root\f[R] plus the
\f[I]source\f[R] hostname.
If enabled with the above example, the \f[I]target\f[R] will be
\f[CR]pool/Backups/host01/vm/myOS\f[R].
.TP
\f[B]\[en]push_to:\f[BI]hostname\f[B]\f[R]
Change the default \f[I]target\f[R] endpoint from \f[B]localhost\f[R] to
the indicated \f[I]hostname\f[R].
.TP
\f[B]\[en]retry=\f[BI]num\-retries\f[B]\f[R]
If replication fails, retry the indicated number of times.
Note that the retry attempts are deferred until after all replciation
jobs are attempted.
.TP
\f[B]\[en]threads=\f[BI]num\-threads\f[B]\f[R]
Run the indicated number of concurrent backup jobs for each
\f[I]site\f[R].
.SS Backup Job Parameters
Without additional parameters, \f[B]zelta policy\f[R] will run a
\f[B]zelta backup\f[R] job for each dataset in the configuration file.
Providing one of the following will limit the backup job.
.PP
\f[B]\f[BI]site\f[B]\f[R] Run a backup job only for the \f[I]site\f[R]
listed.
A \f[I]site\f[R] is a user defined top\-level parameter in the
configuration file representing a list of one or more hosts.
.PP
\f[B]\f[BI]host\f[B]\f[R] Run a backup job only for the \f[I]host\f[R]
listed.
Hosts must be accessible via SSH private\-key authentication or
\f[B]localhost\f[R].
.PP
\f[B]\f[BI]dataset\f[B]\f[R] Run a backup job only for the
\f[I]dataset\f[R] listed.
Note this parameter can match the \f[I]source\f[R] \f[B]or\f[R]
\f[I]target\f[R] dataset, e.g., requesting \f[CR]zroot\f[R] would run
the replication for any matching dataset on any host.
.PP
\f[B]\f[BI]host:dataset\f[B]\f[R] Specify a \f[I]source\f[R] or
\f[I]backup\f[R] dataset endpoint, equivalent to the paramemters of
\f[B]zelta backup\f[R].
.SH FILES
For detailed documentation of the \f[B]zelta policy\f[R] configuraiton
see \f[CR]zelta.conf.example\f[R].
.TP
\f[B]/usr/local/etc/zelta/zelta.conf\f[R]
The default configuration file locaiton.
.TP
\f[B]/usr/local/etc/zelta/zelta.env\f[R]
The default environment override file location.
.SH ENVIRONMENT
For detailed documentation of the \f[B]zelta\f[R] environment variables
see \f[CR]zelta.env.example\f[R].
.TP
\f[B]ZELTA_ETC\f[R]
The directory where \f[B]zelta.conf\f[R] and \f[B]zelta.env\f[R] will be
loaded from.
.SH SEE ALSO
cron(8), ssh(1), zelta(8), zelta\-backup(8), zfs(8)
.SH AUTHORS
Daniel J. Bell \f[I]\c
.MT bellta@belltower.it
.ME \c
\f[R]
.SH WWW
https://zelta.space
